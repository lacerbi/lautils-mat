function y = dilog_quick(x)
%DILOG_APPROX Quick approximation of Spence's function in [0,1].

p = [0.6,0.9,0.985];
y = zeros(size(x));

% Approximate Spence's function via linear interpolation using hard-coded 
% tabular values of dilogarithm (Spence's function)

% The maximum error in [0,1] is ~ 5e-5; mean absolute error is ~ 2e-6

idx = x <= p(1);
if any(idx)
    X1 = [0.00000000; 0.00600000; 0.01200000; 0.01800000; 0.02400000; 0.03000000; 0.03600000; 0.04200000; 0.04800000; 0.05400000; 0.06000000; 0.06600000; 0.07200000; 0.07800000; 0.08400000; 0.09000000; 0.09600000; 0.10200000; 0.10800000; 0.11400000; 0.12000000; 0.12600000; 0.13200000; 0.13800000; 0.14400000; 0.15000000; 0.15600000; 0.16200000; 0.16800000; 0.17400000; 0.18000000; 0.18600000; 0.19200000; 0.19800000; 0.20400000; 0.21000000; 0.21600000; 0.22200000; 0.22800000; 0.23400000; 0.24000000; 0.24600000; 0.25200000; 0.25800000; 0.26400000; 0.27000000; 0.27600000; 0.28200000; 0.28800000; 0.29400000; 0.30000000; 0.30600000; 0.31200000; 0.31800000; 0.32400000; 0.33000000; 0.33600000; 0.34200000; 0.34800000; 0.35400000; 0.36000000; 0.36600000; 0.37200000; 0.37800000; 0.38400000; 0.39000000; 0.39600000; 0.40200000; 0.40800000; 0.41400000; 0.42000000; 0.42600000; 0.43200000; 0.43800000; 0.44400000; 0.45000000; 0.45600000; 0.46200000; 0.46800000; 0.47400000; 0.48000000; 0.48600000; 0.49200000; 0.49800000; 0.50400000; 0.51000000; 0.51600000; 0.52200000; 0.52800000; 0.53400000; 0.54000000; 0.54600000; 0.55200000; 0.55800000; 0.56400000; 0.57000000; 0.57600000; 0.58200000; 0.58800000; 0.59400000; 0.60000000];
    V1 = [0.00000000; 0.00600902; 0.01203619; 0.01808165; 0.02414556; 0.03022805; 0.03632929; 0.04244943; 0.04858863; 0.05474705; 0.06092484; 0.06712218; 0.07333923; 0.07957616; 0.08583315; 0.09211035; 0.09840796; 0.10472615; 0.11106511; 0.11742501; 0.12380605; 0.13020841; 0.13663229; 0.14307789; 0.14954540; 0.15603503; 0.16254699; 0.16908147; 0.17563870; 0.18221889; 0.18882226; 0.19544903; 0.20209943; 0.20877368; 0.21547203; 0.22219471; 0.22894196; 0.23571403; 0.24251116; 0.24933362; 0.25618167; 0.26305556; 0.26995556; 0.27688195; 0.28383500; 0.29081500; 0.29782224; 0.30485701; 0.31191961; 0.31901034; 0.32612951; 0.33327744; 0.34045445; 0.34766088; 0.35489704; 0.36216330; 0.36945998; 0.37678746; 0.38414608; 0.39153623; 0.39895827; 0.40641259; 0.41389959; 0.42141967; 0.42897323; 0.43656069; 0.44418249; 0.45183905; 0.45953083; 0.46725828; 0.47502187; 0.48282208; 0.49065939; 0.49853430; 0.50644733; 0.51439899; 0.52238983; 0.53042039; 0.53849123; 0.54660293; 0.55475609; 0.56295130; 0.57118919; 0.57947039; 0.58779556; 0.59616536; 0.60458049; 0.61304166; 0.62154958; 0.63010501; 0.63870871; 0.64736147; 0.65606410; 0.66481745; 0.67362236; 0.68247973; 0.69139046; 0.70035550; 0.70937581; 0.71845241; 0.72758631];
    % X1 = linspace(0,p(1),101)';
    % V1 = dilog_dumb(X1);
    y(idx) = lininterp1(X1,V1,x(idx));
end

idx = (x > p(1)) & (x <= p(2));
if any(idx)
    X2 = [0.60000000; 0.60300000; 0.60600000; 0.60900000; 0.61200000; 0.61500000; 0.61800000; 0.62100000; 0.62400000; 0.62700000; 0.63000000; 0.63300000; 0.63600000; 0.63900000; 0.64200000; 0.64500000; 0.64800000; 0.65100000; 0.65400000; 0.65700000; 0.66000000; 0.66300000; 0.66600000; 0.66900000; 0.67200000; 0.67500000; 0.67800000; 0.68100000; 0.68400000; 0.68700000; 0.69000000; 0.69300000; 0.69600000; 0.69900000; 0.70200000; 0.70500000; 0.70800000; 0.71100000; 0.71400000; 0.71700000; 0.72000000; 0.72300000; 0.72600000; 0.72900000; 0.73200000; 0.73500000; 0.73800000; 0.74100000; 0.74400000; 0.74700000; 0.75000000; 0.75300000; 0.75600000; 0.75900000; 0.76200000; 0.76500000; 0.76800000; 0.77100000; 0.77400000; 0.77700000; 0.78000000; 0.78300000; 0.78600000; 0.78900000; 0.79200000; 0.79500000; 0.79800000; 0.80100000; 0.80400000; 0.80700000; 0.81000000; 0.81300000; 0.81600000; 0.81900000; 0.82200000; 0.82500000; 0.82800000; 0.83100000; 0.83400000; 0.83700000; 0.84000000; 0.84300000; 0.84600000; 0.84900000; 0.85200000; 0.85500000; 0.85800000; 0.86100000; 0.86400000; 0.86700000; 0.87000000; 0.87300000; 0.87600000; 0.87900000; 0.88200000; 0.88500000; 0.88800000; 0.89100000; 0.89400000; 0.89700000; 0.90000000];
    V2 = [0.72758631; 0.73217508; 0.73677858; 0.74139695; 0.74603033; 0.75067886; 0.75534269; 0.76002197; 0.76471684; 0.76942746; 0.77415399; 0.77889659; 0.78365541; 0.78843062; 0.79322238; 0.79803088; 0.80285628; 0.80769876; 0.81255849; 0.81743567; 0.82233047; 0.82724309; 0.83217372; 0.83712257; 0.84208982; 0.84707569; 0.85208038; 0.85710411; 0.86214710; 0.86720956; 0.87229173; 0.87739384; 0.88251612; 0.88765881; 0.89282217; 0.89800644; 0.90321187; 0.90843874; 0.91368731; 0.91895785; 0.92425065; 0.92956600; 0.93490418; 0.94026550; 0.94565026; 0.95105879; 0.95649139; 0.96194842; 0.96743019; 0.97293706; 0.97846939; 0.98402754; 0.98961189; 0.99522281; 1.00086070; 1.00652597; 1.01221904; 1.01794032; 1.02369026; 1.02946931; 1.03527793; 1.04111661; 1.04698582; 1.05288609; 1.05881792; 1.06478185; 1.07077845; 1.07680827; 1.08287191; 1.08896997; 1.09510309; 1.10127190; 1.10747709; 1.11371934; 1.11999937; 1.12631793; 1.13267577; 1.13907371; 1.14551256; 1.15199319; 1.15851649; 1.16508337; 1.17169482; 1.17835182; 1.18505542; 1.19180672; 1.19860684; 1.20545697; 1.21235835; 1.21931228; 1.22632010; 1.23338325; 1.24050321; 1.24768155; 1.25491991; 1.26222004; 1.26958375; 1.27701297; 1.28450975; 1.29207624; 1.29971472];
    % X2 = linspace(p(1),p(2),101)';
    % V2 = dilog_dumb(X2);
    y(idx) = lininterp1(X2,V2,x(idx));
end

idx = (x > p(2)) & (x <= p(3));
if any(idx)
    X3 = [0.90000000; 0.90085000; 0.90170000; 0.90255000; 0.90340000; 0.90425000; 0.90510000; 0.90595000; 0.90680000; 0.90765000; 0.90850000; 0.90935000; 0.91020000; 0.91105000; 0.91190000; 0.91275000; 0.91360000; 0.91445000; 0.91530000; 0.91615000; 0.91700000; 0.91785000; 0.91870000; 0.91955000; 0.92040000; 0.92125000; 0.92210000; 0.92295000; 0.92380000; 0.92465000; 0.92550000; 0.92635000; 0.92720000; 0.92805000; 0.92890000; 0.92975000; 0.93060000; 0.93145000; 0.93230000; 0.93315000; 0.93400000; 0.93485000; 0.93570000; 0.93655000; 0.93740000; 0.93825000; 0.93910000; 0.93995000; 0.94080000; 0.94165000; 0.94250000; 0.94335000; 0.94420000; 0.94505000; 0.94590000; 0.94675000; 0.94760000; 0.94845000; 0.94930000; 0.95015000; 0.95100000; 0.95185000; 0.95270000; 0.95355000; 0.95440000; 0.95525000; 0.95610000; 0.95695000; 0.95780000; 0.95865000; 0.95950000; 0.96035000; 0.96120000; 0.96205000; 0.96290000; 0.96375000; 0.96460000; 0.96545000; 0.96630000; 0.96715000; 0.96800000; 0.96885000; 0.96970000; 0.97055000; 0.97140000; 0.97225000; 0.97310000; 0.97395000; 0.97480000; 0.97565000; 0.97650000; 0.97735000; 0.97820000; 0.97905000; 0.97990000; 0.98075000; 0.98160000; 0.98245000; 0.98330000; 0.98415000; 0.98500000];
    V3 = [1.29971472; 1.30189238; 1.30407607; 1.30626586; 1.30846179; 1.31066393; 1.31287234; 1.31508709; 1.31730824; 1.31953585; 1.32176999; 1.32401073; 1.32625813; 1.32851228; 1.33077323; 1.33304107; 1.33531586; 1.33759769; 1.33988662; 1.34218275; 1.34448615; 1.34679691; 1.34911510; 1.35144082; 1.35377415; 1.35611519; 1.35846402; 1.36082074; 1.36318545; 1.36555824; 1.36793921; 1.37032848; 1.37272614; 1.37513230; 1.37754707; 1.37997057; 1.38240291; 1.38484421; 1.38729460; 1.38975420; 1.39222313; 1.39470153; 1.39718954; 1.39968729; 1.40219493; 1.40471261; 1.40724047; 1.40977867; 1.41232737; 1.41488674; 1.41745694; 1.42003815; 1.42263055; 1.42523432; 1.42784966; 1.43047677; 1.43311584; 1.43576709; 1.43843074; 1.44110701; 1.44379613; 1.44649835; 1.44921392; 1.45194309; 1.45468613; 1.45744333; 1.46021497; 1.46300135; 1.46580280; 1.46861962; 1.47145217; 1.47430079; 1.47716587; 1.48004777; 1.48294692; 1.48586372; 1.48879862; 1.49175209; 1.49472462; 1.49771671; 1.50072890; 1.50376177; 1.50681591; 1.50989196; 1.51299058; 1.51611250; 1.51925845; 1.52242926; 1.52562576; 1.52884889; 1.53209961; 1.53537898; 1.53868813; 1.54202829; 1.54540076; 1.54880699; 1.55224853; 1.55572709; 1.55924454; 1.56280296; 1.56640462];
    % X3 = linspace(p(2),1,101)';
    % V3 = dilog_dumb(X3);
    y(idx) = lininterp1(X3,V3,x(idx));
end

idx = x > p(3);
if any(idx)
    X4 = [0.98500000; 0.98515000; 0.98530000; 0.98545000; 0.98560000; 0.98575000; 0.98590000; 0.98605000; 0.98620000; 0.98635000; 0.98650000; 0.98665000; 0.98680000; 0.98695000; 0.98710000; 0.98725000; 0.98740000; 0.98755000; 0.98770000; 0.98785000; 0.98800000; 0.98815000; 0.98830000; 0.98845000; 0.98860000; 0.98875000; 0.98890000; 0.98905000; 0.98920000; 0.98935000; 0.98950000; 0.98965000; 0.98980000; 0.98995000; 0.99010000; 0.99025000; 0.99040000; 0.99055000; 0.99070000; 0.99085000; 0.99100000; 0.99115000; 0.99130000; 0.99145000; 0.99160000; 0.99175000; 0.99190000; 0.99205000; 0.99220000; 0.99235000; 0.99250000; 0.99265000; 0.99280000; 0.99295000; 0.99310000; 0.99325000; 0.99340000; 0.99355000; 0.99370000; 0.99385000; 0.99400000; 0.99415000; 0.99430000; 0.99445000; 0.99460000; 0.99475000; 0.99490000; 0.99505000; 0.99520000; 0.99535000; 0.99550000; 0.99565000; 0.99580000; 0.99595000; 0.99610000; 0.99625000; 0.99640000; 0.99655000; 0.99670000; 0.99685000; 0.99700000; 0.99715000; 0.99730000; 0.99745000; 0.99760000; 0.99775000; 0.99790000; 0.99805000; 0.99820000; 0.99835000; 0.99850000; 0.99865000; 0.99880000; 0.99895000; 0.99910000; 0.99925000; 0.99940000; 0.99955000; 0.99970000; 0.99985000; 1.00000000];
    V4 = [1.56640462; 1.56704488; 1.56768659; 1.56832975; 1.56897438; 1.56962050; 1.57026812; 1.57091726; 1.57156794; 1.57222017; 1.57287398; 1.57352937; 1.57418638; 1.57484501; 1.57550528; 1.57616723; 1.57683086; 1.57749620; 1.57816327; 1.57883208; 1.57950267; 1.58017506; 1.58084927; 1.58152532; 1.58220323; 1.58288305; 1.58356478; 1.58424845; 1.58493411; 1.58562176; 1.58631144; 1.58700319; 1.58769702; 1.58839298; 1.58909110; 1.58979141; 1.59049394; 1.59119873; 1.59190581; 1.59261523; 1.59332703; 1.59404124; 1.59475791; 1.59547708; 1.59619879; 1.59692310; 1.59765004; 1.59837968; 1.59911206; 1.59984723; 1.60058526; 1.60132620; 1.60207011; 1.60281706; 1.60356711; 1.60432033; 1.60507679; 1.60583656; 1.60659974; 1.60736639; 1.60813661; 1.60891049; 1.60968811; 1.61046959; 1.61125503; 1.61204454; 1.61283824; 1.61363626; 1.61443872; 1.61524577; 1.61605757; 1.61687426; 1.61769603; 1.61852305; 1.61935553; 1.62019367; 1.62103771; 1.62188790; 1.62274451; 1.62360783; 1.62447819; 1.62535594; 1.62624149; 1.62713525; 1.62803774; 1.62894949; 1.62987113; 1.63080338; 1.63174706; 1.63270314; 1.63367275; 1.63465726; 1.63565834; 1.63667809; 1.63771922; 1.63878532; 1.63988149; 1.64101542; 1.64220016; 1.64346323; 1.64493407];    
    % X4 = linspace(p(3),1,101)';
    % V4 = dilog_dumb(X4);
    y(idx) = lininterp1(X4,V4,x(idx));
end

idx = x < 0 | x > 1;
if any(idx)
    y(idx) = NaN;
end

end


function Vout = lininterp1(X,V,Xq)
%LININTERP1 Linear interpolation.

N = size(X,1);
tol = sqrt(eps);

% Gets the x spacing
dx = 1/(X(2)-X(1));  % one over to perform divide only once
Xq = Xq - X(1);      % subtract minimum of x

Xqi = Xq*dx+1;          % indices of nearest-lower-neighbors
flag = Xqi<1 | Xqi>N*(1+tol) | isnan(Xqi);
                                % finds indices out of bounds
Xqi = floor(Xqi);
                                
V = [V; NaN];
Xqi(flag) = N-1;

delta = Xqi - Xq*dx;

linind1 = bsxfun(@plus, Xqi, N*(0:size(V,2)-1));
linind2 = bsxfun(@plus, Xqi + 1, N*(0:size(V,2)-1));

out1 = reshape(V(linind1),size(Xq));
out2 = reshape(V(linind2),size(Xq));

out1(isnan(out1)) = 0;
out2(isnan(out2)) = 0;

Vout = bsxfun(@times,delta,out1) + bsxfun(@times,1-delta,out2);
Vout(flag) = NaN;

end

function hardcode_dilog(p)
%HARDCODE_DILOG Compute hard-coded tables for dilogarithm.

pp = [0,p,1];

for i = 1:numel(p)+1
    X = linspace(pp(i),pp(i+1),101)';
    V = dilog_dumb(X);
    
    fprintf('X%d = [', i);
    for j = 1:numel(X)
        fprintf('%.8f',X(j));
        if j < numel(X); fprintf('; '); end 
    end
    fprintf('];\n');

    fprintf('V%d = [', i);
    for j = 1:numel(V)
        fprintf('%.8f',V(j));
        if j < numel(V); fprintf('; '); end 
    end
    fprintf('];\n\n');    
end

end